<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CPU Scheduling Simulator</title>
  <style>
    /* --- SHARED STYLES --- */
    * { box-sizing: border-box; font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif; }
    body {
      margin: 0;
      background: #0f172a;
      color: #e5e7eb;
      overflow-x: hidden;
    }

    /* --- LANDING PAGE STYLES (INDEX) --- */
    #landing-view {
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      background: #020617;
    }
    .bg-glow {
      position: absolute;
      inset: -25%;
      background:
        radial-gradient(circle at 30% 30%, #1e3a8a55, transparent 45%),
        radial-gradient(circle at 70% 70%, #6d28d955, transparent 45%);
      animation: moveGlow 60s ease-in-out infinite;
    }
    @keyframes moveGlow {
      0% { transform: translate(0, 0) }
      50% { transform: translate(-8%, 8%) }
      100% { transform: translate(0, 0) }
    }
    .particle {
      position: absolute;
      width: 6px;
      height: 6px;
      background: #38bdf8;
      border-radius: 50%;
      opacity: .45;
      animation: float 40s linear infinite;
    }
    @keyframes float {
      from { transform: translateY(130vh) }
      to { transform: translateY(-30vh) }
    }
    .container {
      position: relative;
      z-index: 2;
      max-width: 780px;
      padding: 56px;
      border-radius: 22px;
      background: rgba(2, 6, 23, 0.94);
      border: 1px solid #1f2937;
      box-shadow: 0 40px 90px rgba(0, 0, 0, 0.75);
      text-align: center;
      animation: bootIn 4.5s ease forwards;
    }
    @keyframes bootIn {
      from { opacity: 0; transform: scale(.85) translateY(80px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }
    .badge {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 12px;
      letter-spacing: .1em;
      color: #a5b4fc;
      border: 1px solid #4f46e5;
      margin-bottom: 26px;
    }
    .cpu {
      position: relative;
      width: 120px;
      height: 120px;
      margin: 0 auto 32px;
    }
    .ring {
      position: absolute;
      inset: 0;
      border-radius: 18px;
      border: 2px solid #6366f1;
      animation: spin 60s linear infinite;
    }
    .ring:nth-child(2) { inset: 16px; border-color: #38bdf8; animation: spin 80s linear infinite reverse; }
    .ring:nth-child(3) { inset: 32px; border-color: #22c55e; animation: spin 110s linear infinite; }
    .core {
      position: absolute;
      inset: 48px;
      border-radius: 10px;
      background: #a5b4fc;
      box-shadow: 0 0 20px #a5b4fc;
      animation: pulse 6s ease-in-out infinite;
    }
    @keyframes spin { to { transform: rotate(360deg) } }
    @keyframes pulse { 0%, 100% { opacity: 1 } 50% { opacity: .55 } }
    h1 { margin: 0; font-size: 44px; }
    h1 span { color: #a5b4fc; }
    .subtitle { margin-top: 18px; font-size: 16px; color: #9ca3af; min-height: 90px; line-height: 1.7; white-space: pre-line; }
    .loader { margin: 36px auto; width: 82%; height: 9px; border-radius: 10px; background: #020617; border: 1px solid #1f2937; overflow: hidden; }
    .bar { height: 100%; width: 100%; background: linear-gradient(90deg, #6366f1, #38bdf8); box-shadow: 0 0 14px #6366f1; animation: load 12s ease forwards; }
    @keyframes load { from { width: 0% } to { width: 100% } }
    .actions { display: flex; justify-content: center; gap: 20px; margin-top: 34px; }
    .btn-landing { padding: 15px 34px; border-radius: 999px; font-size: 15px; font-weight: 600; cursor: pointer; border: none; }
    .primary { background: linear-gradient(135deg, #6366f1, #4f46e5); color: white; }
    .secondary-landing { background: transparent; color: #c7d2fe; border: 1px solid #374151; }
    .footer { margin-top: 34px; font-size: 13px; color: #6b7280; }

    /* --- SIMULATOR STYLES (SIMULATOR) --- */
    #simulator-view {
      display: none; /* Hidden by default */
      padding: 20px;
    }
    .app {
      max-width: 1100px;
      margin: 0 auto;
      background: #020617;
      border-radius: 16px;
      padding: 20px 24px 32px;
      box-shadow: 0 25px 40px rgba(0,0,0,0.6);
      border: 1px solid #1f2937;
    }
    .sim-subtitle { color: #9ca3af; font-size: 0.9rem; margin-bottom: 1rem; }
    .grid { display: grid; grid-template-columns: 1.2fr 1fr; gap: 16px; margin-bottom: 1rem; }
    .card { background: #020617; border-radius: 14px; padding: 14px 16px; border: 1px solid #1f2937; margin-bottom: 16px; }
    .card h3 { margin-top: 0; margin-bottom: 8px; font-size: 1rem; }
    label { display: block; font-size: 0.8rem; margin-bottom: 4px; color: #9ca3af; }
    input, select { width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid #374151; background: #030712; color: #e5e7eb; font-size: 0.85rem; }
    .row { display: flex; gap: 8px; margin-bottom: 8px; }
    .row > div { flex: 1; }
    .btn-sim { border: none; border-radius: 999px; padding: 7px 14px; font-size: 0.85rem; cursor: pointer; display: inline-flex; align-items: center; gap: 6px; }
    .btn-primary { background: linear-gradient(135deg, #6366f1, #4f46e5); color: white; box-shadow: 0 10px 20px rgba(79,70,229,0.4); }
    .btn-secondary { background: #111827; color: #e5e7eb; border: 1px solid #374151; }
    .btn-ghost { background: transparent; color: #9ca3af; border: 1px dashed #4b5563; }
    table { width: 100%; border-collapse: collapse; margin-top: 8px; font-size: 0.8rem; }
    th, td { border-bottom: 1px solid #1f2937; padding: 4px 6px; text-align: center; }
    th { color: #9ca3af; font-weight: 500; }
    .gantt-container { margin-top: 8px; padding: 12px; border-radius: 12px; background: radial-gradient(circle at top left, rgba(59,130,246,0.25), transparent 55%), radial-gradient(circle at bottom right, rgba(236,72,153,0.25), transparent 55%), #020617; border: 1px solid #1f2937; }
    .gantt-bar-row { position: relative; display: flex; align-items: stretch; height: 60px; border-radius: 10px; overflow: hidden; background: rgba(15,23,42,0.9); border: 1px solid #1f2937; }
    .gantt-segment { position: relative; display: flex; justify-content: center; align-items: center; font-size: 0.75rem; font-weight: 500; border-right: 1px solid rgba(15,23,42,0.6); color: #020617; overflow: hidden; transition: all 0.3s ease; }
    .gantt-segment span { padding: 0 4px; backdrop-filter: blur(4px); border-radius: 999px; background: rgba(15,23,42,0.2); }
    .time-axis { display: flex; justify-content: space-between; font-size: 0.7rem; margin-top: 6px; color: #9ca3af; }
    .metrics-grid { display: grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap: 8px; margin-top: 8px; }
    .metric { padding: 8px 10px; border-radius: 10px; background: #020617; border: 1px solid #1f2937; font-size: 0.78rem; }
    .metric-label { color: #9ca3af; font-size: 0.7rem; }
    .metric-value { font-size: 1rem; font-weight: 600; }
    .error { color: #fca5a5; font-size: 0.8rem; margin-top: 4px; }
    .pill { font-size: 0.7rem; padding: 2px 8px; border-radius: 999px; border: 1px solid #4b5563; color: #9ca3af; }
    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>

<div id="landing-view">
  <div class="bg-glow"></div>
  <div class="particle" style="left:15%"></div>
  <div class="particle" style="left:35%"></div>
  <div class="particle" style="left:55%"></div>
  <div class="particle" style="left:75%"></div>

  <div class="container">
    <div class="badge">OPERATING SYSTEMS PROJECT</div>
    <div class="cpu">
      <div class="ring"></div>
      <div class="ring"></div>
      <div class="ring"></div>
      <div class="core"></div>
    </div>
    <h1>CPU Scheduling <span>Simulator</span></h1>
    <div class="subtitle" id="subtitle"></div>
    <div class="loader">
      <div class="bar"></div>
    </div>
    <div class="actions">
      <button class="btn-landing primary" onclick="enterSimulator()">Enter Simulator</button>
      <button class="btn-landing secondary-landing">Project Info</button>
    </div>
    <div class="footer">System initialization complete. Scheduler ready.</div>
  </div>
</div>

<div id="simulator-view">
  <div class="app">
    <h1>CPU Scheduling Simulator</h1>
    <div class="sim-subtitle">
      Simulate <span style="color:#a5b4fc">FCFS, SJF, Round Robin, Priority</span> with Gantt chart and average metrics.
    </div>

    <div class="grid">
      <div class="card">
        <h3>1. Add Processes</h3>
        <div class="row">
          <div><label>PID</label><input type="text" id="pid"></div>
          <div><label>Arrival Time</label><input type="number" id="arrival" min="0"></div>
        </div>
        <div class="row">
          <div><label>Burst Time</label><input type="number" id="burst" min="1"></div>
          <div><label>Priority (Lower = Higher)</label><input type="number" id="priority" min="1"></div>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
          <button class="btn-sim btn-primary" id="addProcessBtn">+ Add Process</button>
          <button class="btn-sim btn-secondary" id="clearProcessesBtn">Clear All</button>
          <button class="btn-sim btn-ghost" id="sampleBtn">Load Sample</button>
        </div>
        <div id="inputError" class="error"></div>
        <table id="processTable">
          <thead><tr><th>PID</th><th>Arrival</th><th>Burst</th><th>Prio</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="card">
        <h3>2. Choose Algorithm</h3>
        <div class="row">
          <div>
            <label>Scheduling Algorithm</label>
            <select id="algorithm">
              <option value="fcfs">FCFS (First-Come, First-Served)</option>
              <option value="sjf">SJF (Non-preemptive)</option>
              <option value="rr">Round Robin</option>
              <option value="priority">Priority (Non-preemptive)</option>
            </select>
          </div>
          <div id="quantumWrapper" style="display:none; max-width: 140px;">
            <label>Quantum (RR)</label>
            <input type="number" id="quantum" value="2" min="1">
          </div>
        </div>
        <div style="display:flex; align-items:center; gap:10px; margin-top:10px;">
          <button class="btn-sim btn-primary" id="runBtn">▶ Run Simulation</button>
          <button class="btn-sim btn-secondary" id="animateBtn">⏱ Play Timeline</button>
          <span class="pill" id="algoInfo">Using FCFS</span>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>3. Gantt Chart</h3>
      <div class="gantt-container">
        <div id="ganttBar" class="gantt-bar-row"></div>
        <div id="ganttTimeAxis" class="time-axis"></div>
      </div>
    </div>

    <div class="card">
      <h3>4. Performance Metrics</h3>
      <div class="metrics-grid">
        <div class="metric"><div class="metric-label">Avg Waiting</div><div class="metric-value" id="avgWaiting">–</div></div>
        <div class="metric"><div class="metric-label">Avg Turnaround</div><div class="metric-value" id="avgTurnaround">–</div></div>
        <div class="metric"><div class="metric-label">Avg Response</div><div class="metric-value" id="avgResponse">–</div></div>
        <div class="metric"><div class="metric-label">CPU Util</div><div class="metric-value" id="cpuUtil">–</div></div>
      </div>
      <table id="metricsTable">
        <thead><tr><th>PID</th><th>Arr</th><th>Burst</th><th>Prio</th><th>Comp</th><th>TAT</th><th>WT</th><th>RT</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<script>
  /* --- LANDING LOGIC --- */
  const text = "Initializing CPU scheduling environment...\nLoading process control blocks...\nPreparing ready and waiting queues...\nScheduler modules loaded successfully.";
  let charIdx = 0;
  const subtitleEl = document.getElementById("subtitle");
  const typing = setInterval(() => {
    if(charIdx < text.length) subtitleEl.textContent += text[charIdx++];
    else clearInterval(typing);
  }, 110);

  if ('speechSynthesis' in window) {
    const msg = new SpeechSynthesisUtterance("Hello. Welcome to my CPU Scheduling Simulator. System initialization has started.");
    msg.rate = 0.75;
    speechSynthesis.speak(msg);
  }

  function enterSimulator() {
    document.getElementById('landing-view').style.display = 'none';
    document.getElementById('simulator-view').style.display = 'block';
    autoPid();
  }

  /* --- SIMULATOR LOGIC --- */
  let processes = [];
  let nextPidNumber = 1;
  let lastSchedule = null;
  let animationInterval = null;
  const colors = ["#a5b4fc", "#fca5a5", "#f9a8d4", "#6ee7b7", "#fde68a", "#7dd3fc", "#c4b5fd"];

  const pidInput = document.getElementById("pid");
  const arrivalInput = document.getElementById("arrival");
  const burstInput = document.getElementById("burst");
  const priorityInput = document.getElementById("priority");
  const processTableBody = document.querySelector("#processTable tbody");
  const metricsTableBody = document.querySelector("#metricsTable tbody");
  const algorithmSelect = document.getElementById("algorithm");
  const quantumWrapper = document.getElementById("quantumWrapper");
  const quantumInput = document.getElementById("quantum");
  const algoInfo = document.getElementById("algoInfo");
  const inputError = document.getElementById("inputError");
  const ganttBar = document.getElementById("ganttBar");
  const ganttTimeAxis = document.getElementById("ganttTimeAxis");

  function autoPid() { pidInput.value = "P" + nextPidNumber; }

  function renderProcessTable() {
    processTableBody.innerHTML = "";
    processes.forEach((p, idx) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${p.pid}</td><td>${p.arrival}</td><td>${p.burst}</td><td>${p.priority ?? "-"}</td><td><button class="btn-ghost" onclick="removeProcess(${idx})">✕</button></td>`;
      processTableBody.appendChild(tr);
    });
  }

  window.removeProcess = (idx) => {
    processes.splice(idx, 1);
    renderProcessTable();
  };

  function describeAlgo() {
    const algo = algorithmSelect.value;
    quantumWrapper.style.display = (algo === "rr") ? "block" : "none";
    algoInfo.textContent = `Using ${algo.toUpperCase()}`;
  }

  // Scheduling Algos
  function scheduleFCFS(procList) {
    const procs = [...procList].sort((a, b) => a.arrival - b.arrival);
    const schedule = []; const info = {}; let time = 0;
    procs.forEach(p => {
      if (!info[p.pid]) info[p.pid] = { firstStart: null };
      if (time < p.arrival) time = p.arrival;
      const start = time; const end = start + p.burst;
      schedule.push({ pid: p.pid, start, end });
      if (info[p.pid].firstStart === null) info[p.pid].firstStart = start;
      time = end;
    });
    return { schedule, info };
  }

  function scheduleSJF(procList) {
    const n = procList.length; const procs = procList.map(p => ({ ...p }));
    const schedule = []; const info = {}; procs.forEach(p => info[p.pid] = { firstStart: null });
    let time = 0, completed = 0; const done = new Set();
    while (completed < n) {
      const available = procs.filter(p => !done.has(p.pid) && p.arrival <= time);
      if (available.length === 0) {
        time = Math.min(...procs.filter(p => !done.has(p.pid)).map(p => p.arrival));
        continue;
      }
      available.sort((a, b) => a.burst - b.burst || a.arrival - b.arrival);
      const p = available[0]; const start = time; const end = start + p.burst;
      schedule.push({ pid: p.pid, start, end });
      if (info[p.pid].firstStart === null) info[p.pid].firstStart = start;
      time = end; done.add(p.pid); completed++;
    }
    return { schedule, info };
  }

  function schedulePriority(procList) {
    const n = procList.length; const procs = procList.map(p => ({ ...p }));
    const schedule = []; const info = {}; procs.forEach(p => info[p.pid] = { firstStart: null });
    let time = 0, completed = 0; const done = new Set();
    while (completed < n) {
      const available = procs.filter(p => !done.has(p.pid) && p.arrival <= time);
      if (available.length === 0) {
        time = Math.min(...procs.filter(p => !done.has(p.pid)).map(p => p.arrival));
        continue;
      }
      available.sort((a, b) => (a.priority ?? 99) - (b.priority ?? 99) || a.arrival - b.arrival);
      const p = available[0]; const start = time; const end = start + p.burst;
      schedule.push({ pid: p.pid, start, end });
      if (info[p.pid].firstStart === null) info[p.pid].firstStart = start;
      time = end; done.add(p.pid); completed++;
    }
    return { schedule, info };
  }

  function scheduleRR(procList, quantum) {
    const procs = procList.map(p => ({ ...p, remaining: p.burst })).sort((a, b) => a.arrival - b.arrival);
    const schedule = []; const info = {}; procs.forEach(p => info[p.pid] = { firstStart: null });
    let time = Math.min(...procs.map(p => p.arrival)), i = 0, completed = 0; const ready = [];
    const pushArr = (t) => { while (i < procs.length && procs[i].arrival <= t) { ready.push(procs[i]); i++; } };
    pushArr(time);
    while (completed < procs.length) {
      if (ready.length === 0) { time = procs[i].arrival; pushArr(time); continue; }
      const p = ready.shift(); const start = time; const run = Math.min(quantum, p.remaining);
      const end = start + run; schedule.push({ pid: p.pid, start, end });
      if (info[p.pid].firstStart === null) info[p.pid].firstStart = start;
      p.remaining -= run; time = end; pushArr(time);
      if (p.remaining > 0) ready.push(p); else completed++;
    }
    return { schedule, info };
  }

  function runSimulation() {
    if (processes.length === 0) { inputError.textContent = "Add processes first."; return; }
    inputError.textContent = "";
    const algo = algorithmSelect.value;
    let res;
    if (algo === "fcfs") res = scheduleFCFS(processes);
    else if (algo === "sjf") res = scheduleSJF(processes);
    else if (algo === "priority") res = schedulePriority(processes);
    else res = scheduleRR(processes, parseInt(quantumInput.value));

    lastSchedule = res;
    renderGantt(res.schedule);
    const metrics = computeMetrics(res.schedule, res.info, processes);
    renderMetrics(metrics);
  }

  function renderGantt(schedule) {
    ganttBar.innerHTML = ""; ganttTimeAxis.innerHTML = "";
    if (!schedule.length) return;
    const total = Math.max(...schedule.map(s => s.end)) - Math.min(...schedule.map(s => s.start));
    schedule.forEach(seg => {
      const div = document.createElement("div");
      div.className = "gantt-segment";
      div.style.width = ((seg.end - seg.start) / total * 100) + "%";
      div.style.background = colors[processes.findIndex(p => p.pid === seg.pid) % colors.length];
      div.innerHTML = `<span>${seg.pid}</span>`;
      ganttBar.appendChild(div);
    });
    const times = [...new Set(schedule.flatMap(s => [s.start, s.end]))].sort((a,b)=>a-b);
    times.forEach(t => { const d = document.createElement("div"); d.textContent = t; ganttTimeAxis.appendChild(d); });
  }

  function computeMetrics(schedule, info, procList) {
    const completion = {};
    schedule.forEach(s => completion[s.pid] = Math.max(completion[s.pid] || 0, s.end));
    const results = procList.map(p => {
      const ct = completion[p.pid], tat = ct - p.arrival, wt = tat - p.burst;
      return { ...p, completion: ct, turnaround: tat, waiting: wt, response: (info[p.pid].firstStart - p.arrival) };
    });
    return {
      perProcess: results,
      avgWaiting: results.reduce((a, b) => a + b.waiting, 0) / results.length,
      avgTurnaround: results.reduce((a, b) => a + b.turnaround, 0) / results.length,
      avgResponse: results.reduce((a, b) => a + b.response, 0) / results.length,
      cpuUtil: 100
    };
  }

  function renderMetrics(m) {
    document.getElementById("avgWaiting").textContent = m.avgWaiting.toFixed(2);
    document.getElementById("avgTurnaround").textContent = m.avgTurnaround.toFixed(2);
    document.getElementById("avgResponse").textContent = m.avgResponse.toFixed(2);
    document.getElementById("cpuUtil").textContent = "100%";
    metricsTableBody.innerHTML = m.perProcess.map(p => `<tr><td>${p.pid}</td><td>${p.arrival}</td><td>${p.burst}</td><td>${p.priority || "-"}</td><td>${p.completion}</td><td>${p.turnaround}</td><td>${p.waiting}</td><td>${p.response}</td></tr>`).join("");
  }

  // Events
  document.getElementById("addProcessBtn").onclick = () => {
    processes.push({ pid: pidInput.value, arrival: parseInt(arrivalInput.value) || 0, burst: parseInt(burstInput.value) || 1, priority: parseInt(priorityInput.value) || 1 });
    nextPidNumber++; renderProcessTable(); autoPid();
  };
  document.getElementById("sampleBtn").onclick = () => {
    processes = [{pid:"P1",arrival:0,burst:5,priority:2},{pid:"P2",arrival:1,burst:3,priority:1},{pid:"P3",arrival:2,burst:8,priority:3}];
    nextPidNumber = 4; renderProcessTable();
  };
  document.getElementById("clearProcessesBtn").onclick = () => { processes = []; nextPidNumber = 1; renderProcessTable(); autoPid(); };
  algorithmSelect.onchange = describeAlgo;
  document.getElementById("runBtn").onclick = runSimulation;
  document.getElementById("animateBtn").onclick = () => {
    const segs = Array.from(ganttBar.children);
    segs.forEach(s => s.style.opacity = "0.2");
    let i = 0;
    const int = setInterval(() => {
      if(i >= segs.length) return clearInterval(int);
      segs[i].style.opacity = "1";
      segs[i].style.transform = "scaleY(1.1)";
      setTimeout(() => segs[i-1] && (segs[i-1].style.transform = "scaleY(1)"), 400);
      i++;
    }, 600);
  };
</script>
</body>
</html>
